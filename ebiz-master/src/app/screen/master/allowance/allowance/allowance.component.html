<!-- <p>allowance works!</p>
 <p>accommodation works!</p> -->
<div class="col-12 boxcolor-mm background-Slide animate__animated animate__fadeIn" *ngIf="emp_list.length > 0" style="height: 350px">
  <div class="row math-height">
    <div class="col-lg-12">
      <div class="card box-shadow-1 mt-3">
        <div class="card-body m-0 p-0">
          <div class="row mx-0">
            <div class="col-lg-6 col-md-6 col-sm-12" style="min-height: 67px">
              <div class="marker marker-ribbon marker-top-blue pos-absolute mt-4 l-0 pl-5 pr-5">
                <p class="tx-24 m-0">
                  &#32;
                  <i class="fa fa-bed d-none"></i>
                  <img src="{{ ws.checkPathForDevServer('assets/imgs/allowance-white.png') }}" class="mr-1 mb-2" width="26" height="24" />
                  &#32;ALLOWANCE
                </p>
              </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-12">
              <div class="container px-0">
                <div class="text-center text-md-right mt-4 pr-4" *ngIf="status != true">
                  <p class="tx-24 m-0 tx-top-blue text-bold-500">
                    {{ namex }}
                  </p>
                </div>
                <!-- {{ emp_idS }} -->
                <div class="mt-4 col-12 col-md-10 col-lg-8 ml-md-auto" *ngIf="status">
                  <mat-select #select [(ngModel)]="emp_idS" (ngModelChange)="update_userByDOC(emp_idS)" class="form-control line-height-2 tx-gray-700 text-bold-500" placeholder="Select">
                    <mat-option *ngFor="let topping of emp_list; let i = index" [value]="topping.emp_id">
                      {{ topping.userDisplay }}
                    </mat-option>
                  </mat-select>
                </div>
                <div class="text-right mt-4 pr-4" *ngIf="pathPhase1">
                  <span class="link-text">
                    <p class="tx-14 m-0 text-bold-500" (click)="OpenDocument(doc_id, pathPhase1)">
                      Document No: {{ doc_id }}
                    </p>
                    <i class="fa fa-external-link ml-1"></i>
                  </span>
                </div>
              </div>
            </div>

            <!-- ** Traveler Detail -->
            <div class="col-12" *ngIf="userDetail">
              <div class="container border-bottom-3 border-bottom-grey-blue border-bottom-lighten-5 mb-4 py-4">
                <div class="row no-gutters">
                  <p class="col-4 col-lg-2 col-md-2 tx-gray-700 tx-14 text-dark text-bold-500">Travel Topic :</p>
                  <p class="col-8 col-lg-10 col-md-10 tx-gray-700 tx-14 text-bold-500 text-capitalize">
                    {{ userDetail.travel_topic ? userDetail.travel_topic : '' }}
                  </p>
                  <p class="col-4 col-md-2 tx-gray-700 tx-14 text-dark text-bold-500">Business Date :</p>
                  <p class="col-8 col-md-4 tx-gray-700 tx-14 text-bold-500">
                    {{ userDetail.business_date ? userDetail.business_date : '' }}
                  </p>
                  <p class="col-4 col-md-2 offset-0 offset-md-1 tx-gray-700 tx-14 m-0 text-dark text-bold-500">
                    Travel Date :
                  </p>
                  <p class="col-8 col-md-4 tx-gray-700 tx-14 text-bold-500">
                    {{ userDetail.travel_date ? userDetail.travel_date : '' }}
                  </p>
                  <p class="col-4 col-md-2 tx-gray-700 tx-14 text-dark text-bold-500">{{ TRAVEL_TYPE }}</p>
                  <p class="col-8 col-md-4 tx-gray-700 tx-14 text-bold-500">
                    {{ userDetail.country_city ? userDetail.country_city : '' }}
                  </p>
                  <p class="col-4 col-md-2 tx-gray-700 tx-14 text-dark text-bold-500">Total Traveler(s) :</p>
                  <p class="col-8 col-md-4 tx-gray-700 tx-14 text-bold-500">{{ emp_list.length }} Person(s)</p>
                </div>
              </div>
            </div>
            <!-- ** Traveler Detail -->

            <div class="col-12 py-3 mt-0 mb-4">
              <div class="row justify-content-center align-items-baseline">
                <ul id="progressbar" class="px-0 px-md-1 mb-0">
                  <li class="cursor-pointer" [ngClass]="{ active: docStatus(1) }" id="time"><strong></strong></li>
                  <li class="cursor-pointer" [ngClass]="{ active: docStatus(2) }" id="pencil"><strong></strong></li>
                  <li class="cursor-pointer" [ngClass]="{ active: docStatus(3) }" id="cog"><strong></strong></li>
                  <li class="cursor-pointer" [ngClass]="{ active: docStatus(4) }" id="check"><strong></strong></li>
                </ul>
              </div>
            </div>
          </div>

          <div class class="col-lg-12 pt-2 pl-4 pr-4 py-3">
            <mat-expansion-panel class="margin-top margin-bottoms mx-2 radiusX box-shadow-1 mb-3" [expanded]="panel.show">
              <mat-expansion-panel-header (click)="panel.show = !panel.show">
                <mat-panel-title>
                  <mat-icon class="material-icons">file_copy</mat-icon>
                  <mat-panel-description class="margin-left"> Daily Allowance </mat-panel-description>
                </mat-panel-title>
              </mat-expansion-panel-header>
              <div class="col-12 table-responsive scroll-hori" style="max-height: 350px; max-width: 100%">
                <!--  style="height:250px;" -->
                <table class="table table-striped table-hover table-bordered h-50 mb-0" style="max-height: 350px; max-width: 100%">
                  <thead class="text-center tx-gray-700">
                    <tr>
                      <th style="min-width: 30px">Days</th>
                      <th style="min-width: 150px">Date</th>
                      <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                        <th style="min-width: 40px">&lt; 6 hr</th>
                        <th style="min-width: 40px">6-12 hr</th>
                        <th style="min-width: 40px">&gt; 12 hr</th>
                      </ng-container>
                      <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'">
                        <th style="min-width: 100px">ไม่ค้างคืน</th>
                        <th style="min-width: 100px">ค้างคืน</th>
                      </ng-container>
                      <th style="min-width: 100px">Total</th>
                      <th style="min-width: 200px">Remark</th>
                    </tr>
                  </thead>

                  <tbody class="border-0 text-center tx-gray-700">
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                      <tr class="" *ngIf="allowance_detail.length <= 0">
                        <td colspan="7">No data</td>
                      </tr>
                    </ng-container>
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'">
                      <tr class="" *ngIf="allowance_detail.length <= 0">
                        <td colspan="7">No data</td>
                      </tr>
                    </ng-container>

                    <ng-container *ngFor="let a_d of modelref(allowance_detail); let ii = index; let sumx = sumx">
                      <ng-container *ngIf="a_d.emp_id == '' || a_d.id == ''">
                        <tr class="" *ngIf="ii == 0">
                          <td colspan="7">No data</td>
                        </tr>
                      </ng-container>

                      <ng-container *ngIf="a_d.emp_id == emp_idS && a_d.allowance_date != ''">
                        <tr>
                          <td class="" style="height: 30px">
                            <span class="form-control-plaintext">{{ a_d.allowance_days }}</span>
                          </td>
                          <td style="width: 125px; height: 30px">
                            <span class="form-control-plaintext">{{ a_d.allowance_date }}</span>
                          </td>
                          <td style="width: 125px; height: 30px">
                            <span class="form-control-plaintext" *ngIf="a_d.allowance_type_id == ''">{{
                              a_d.allowance_low | currency: ' ':'symbol'
                              }}</span>
                            <input type="text" class="form-control text-center" style="height: 30px" [disabled]="show_button == false || !status" #values_L [(ngModel)]="a_d.values_L" (keypress)="onlyNumberKey($event)" (ngModelChange)="convertInt2('l', a_d, a_d.id, $event,values_L)" *ngIf="a_d.allowance_type_id != ''" />
                          </td>
                          <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                            <td style="width: 125px; height: 30px">
                              <span class="form-control-plaintext" *ngIf="a_d.allowance_type_id == ''">{{
                                a_d.allowance_mid | currency: ' ':'symbol'
                                }}</span>

                              <input type="text" class="form-control text-center" style="height: 30px" [disabled]="show_button == false || !status" [(ngModel)]="a_d.values_M" #values_M (ngModelChange)="convertInt2('m', a_d, a_d.id, $event,values_M)" (keypress)="onlyNumberKey($event)" *ngIf="a_d.allowance_type_id != ''" />
                            </td>
                          </ng-container>
                          <td style="width: 125px; height: 30px">
                            <span class="form-control-plaintext" *ngIf="a_d.allowance_type_id == ''">{{
                              a_d.allowance_hight | currency: ' ':'symbol'
                              }}</span>

                            <input type="text" class="form-control text-center" style="height: 30px" [disabled]="show_button == false || !status" [(ngModel)]="a_d.values_H" #values_H (ngModelChange)="convertInt2('h', a_d, a_d.id, $event,values_H)" (keypress)="onlyNumberKey($event)" *ngIf="a_d.allowance_type_id != ''" />
                          </td>
                          <td class="text-nowrap text-center tx-gray-700" style="height: 30px">
                            <span class="form-control-plaintext text-nowrap">
                              {{
                              allowance_sumFunction(
                              a_d.allowance_low,
                              a_d.allowance_mid,
                              a_d.allowance_hight,
                              a_d.allowance_unit,
                              a_d.id
                              ) | currency: '':''
                              }}
                              <span *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && a_d.allowance_unit != ''">
                                {{ a_d.allowance_unit }}
                              </span>
                              <span *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && a_d.allowance_unit == ''">
                                USD
                              </span>
                              <span *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'"> THB </span>
                            </span>
                          </td>
                          <td class="m-auto" style="height: 30px">
                            <select class="form-control" style="height: 30px" [disabled]="show_button == false || !status" #valuesx [(ngModel)]="a_d.allowance_type_id" (ngModelChange)="model_action_change(a_d.id)">
                              <option class="tx-alignx" value="">-- Select --</option>
                              <option class="text-left" *ngFor="let Dx of arrX['m_allowance_type']; let xx = index" value="{{ Dx.id }}">
                                {{ Dx.name }}
                              </option>
                            </select>
                          </td>
                        </tr>
                      </ng-container>
                    </ng-container>
                  </tbody>
                  <!-- //!! ย้ายไปใส่ใน row remaark -->
                  <tfoot *ngIf="false">
                    <!-- showfromid(allowance_main,emp_idS)  -->
                    <tr *ngFor="let dataa of allowance_main; let ii = index">
                      <td class="stricky" colspan="7" *ngIf="dataa.emp_id == emp_idS">
                        <span class="tx-14 tx-gray-700 font-weight-bold">TOTAL ALLOWANCE</span>&nbsp;&nbsp;
                        <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                          {{ sumfunction(dataa.id, emp_idS) | number }}&nbsp;USD &nbsp;<span class="tx-14 tx-gray-700 font-weight-bold">,</span>&nbsp;
                          <ng-container *ngFor="let mt of data_excel_view">
                            <span class="">{{ picRate(sumfunction(dataa.id, emp_idS), mt.EX_rate) | number }} THB</span>
                          </ng-container>
                        </ng-container>
                        <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'">
                          {{ sumfunction(dataa.id, emp_idS) | currency: '฿':'symbol' }}
                        </ng-container>
                        &nbsp;&nbsp;<span class="tx-14 tx-gray-700 font-weight-bold" *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">LUGGAGE/CLOTHING</span>
                        &nbsp;&nbsp;{{ dataa.luggage_clothing || 0 | currency: '฿':'symbol' }}
                      </td>
                    </tr>
                  </tfoot>
                  <!-- //!! ย้ายไปใส่ใน row remaark -->
                </table>
              </div>
              <div class="mx-4 mt-1">
                <div *ngFor="let dataa of allowance_main; let ii = index" class="mb-1">
                  <div colspan="7" class="row mx-0" *ngIf="dataa.emp_id == emp_idS">
                    <span class="tx-14 tx-gray-700 font-weight-bold">TOTAL ALLOWANCE</span>&nbsp;&nbsp;
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                      {{ sumfunction(dataa.id, emp_idS) || 0 | number }}&nbsp;USD &nbsp;<span class="tx-14 tx-gray-700 font-weight-bold">,</span>&nbsp;
                      <ng-container *ngFor="let mt of data_excel_view">
                        <span class="">{{ picRate(sumfunction(dataa.id, emp_idS), mt.EX_rate) | number }} THB</span>
                      </ng-container>
                    </ng-container>
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'">
                      {{ sumfunction(dataa.id, emp_idS) | currency: '฿':'symbol' }}
                    </ng-container>
                    &nbsp;&nbsp;<span class="tx-14 tx-gray-700 font-weight-bold" *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && false">LUGGAGE/CLOTHING</span>
                    &nbsp;&nbsp;
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && false">
                      <!-- {{ dataa.luggage_clothing || 0 | currency: '฿':'symbol':'' }} -->
                      <input type="text" class="form-control width-15-per" style="height: 30px" [disabled]="show_button == false || !status || no_data == true || load_kh_code == false" #luggage_clothing [(ngModel)]="dataa.luggage_clothing" currencyMask [options]="inputFormatInt" (ngModelChange)="[(dataa.action_change = 'true')]" />
                    </ng-container>
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && no_data === false">
                      <ng-container>
                        <div class="col-12 pt-2">
                          <div class="row">
                            <div class="col-12 px-0 tx-14 tx-gray-700 font-weight-bold">
                              RECORD OF OUTFIT ALLOWANCES
                            </div>
                          </div>
                        </div>

                        <div class="col-12 pt-2" *ngIf="TRAVEL_TYPE_OL == 'oversea'">
                          <div class="row">
                            <div class="col-12 col-md-3 px-0 tx-14 tx-gray-700">LUGGAGE & CLOTHING (THB)</div>
                            <!-- <div class="col-3 border px-0">{{ mt.luggage_clothing | number }}</div> -->
                            <div class="col-12 col-md-3 px-0">
                              <input type="text" class="form-control delete-border-radius" [ngStyle]="{ 'max-height': passport.offsetHeight + 'px' }" [disabled]="show_button == false || !status || no_data == true || load_kh_code == false" #luggage_clothing [(ngModel)]="dataa.luggage_clothing" currencyMask [options]="inputFormatInt" (ngModelChange)="[(dataa.action_change = 'true')]" />
                            </div>
                            <div class="col-12 col-md-2 tx-14 tx-gray-700 px-0 px-md-3">Valid Date</div>

                            <div class="col-12 col-md-3 border px-0 text-right" [ngStyle]="{ 'max-height': passport.offsetHeight + 'px' }">
                              {{
                              dataa.luggage_clothing_date
                              ? dataa.luggage_clothing_date
                              : luggage_clothing_date
                              ? luggage_clothing_date
                              : '-'
                              }}
                              &nbsp;&nbsp;&nbsp;
                            </div>
                          </div>
                        </div>
                        <!-- <pre>{{ passport.clientHeight }}</pre> -->
                        <div class="col-12 pt-2">
                          <div class="row">
                            <div class="col-12 col-md-3 px-0 tx-14 tx-gray-700">PASSPORT (THB)</div>

                            <div class="col-12 col-md-3 px-0 border text-right" #passport>

                              {{
                              dataa.passport
                              ? (dataa.passport || 0 | currency: ' ':'symbol')
                              : (passportValue || 0 | currency: ' ':'symbol')
                              }}
                              &nbsp;&nbsp;
                            </div>
                            <div class="col-12 col-md-2 tx-14 tx-gray-700 px-0 px-md-3">Valid Date</div>
                            <div class="col-12 col-md-3 border px-0 text-right" [ngStyle]="{
                                'max-height': passport.offsetHeight + 'px'
                              }">
                              {{ dataa.passport_date ? dataa.passport_date : passportDate ? passportDate : '-' }}
                              &nbsp;&nbsp;&nbsp;
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </ng-container>
                  </div>
                </div>
                <div *ngFor="let dataa of showfromid(allowance_main, emp_idS); let ii = index">
                  <div class="stricky" colspan="7" *ngIf="dataa.emp_id == emp_idS && ii == 0">
                    <div class="col-12 tx-14 tx-gray-700 font-weight-bold px-0">Remark</div>
                    <div class="col-12 px-0">
                      <textarea [(ngModel)]="dataa.remark" class="form-control" rows="2" [disabled]="show_button == false || !status || no_data == true || load_kh_code == false"></textarea>
                    </div>
                    <!-- value={{dataa.remark}} -->
                  </div>
                </div>
              </div>
            </mat-expansion-panel>
            <div class="d-flex flex-wrap gap pb-2 mx-2" *ngIf="show_button == true">
              <button class="btn btn-round btn-min-width font-weight-bold" (click)="savecheck()" [ngClass]="{
                  ' bg-top-pink text-white': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false || !status">
                Save
              </button>
              <button class="btn btn-round btn-min-width font-weight-bold mr-auto" (click)="cancleEx()" [ngClass]="{
                  'bg-white pink border-pink text-pink ': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false || !status">
                Cancel
              </button>
              <button (click)="OpenModal_Mail(templete_email)" class="btn btn-round btn-min-width font-weight-bold" [ngClass]="{
                  'bg-white border-color-top tx-color-top': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false || !status">
                Send E-mail
              </button>
              <button (click)="openModalx2Test(template2, dailyallowance_Dx)" class="btn btn-round btn-min-width font-weight-bold" [ngClass]="{
                  'bg-top-blue text-white': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Export
              </button>
            </div>
          </div>

          <!-- Full Screan BtnX -->
          <div class="row gap d-none" *ngIf="show_button == true">
            <button class="btn btn-round btn-min-width font-weight-bold" (click)="savecheck()" [ngClass]="{
                ' bg-top-pink text-white': no_data == false,
                'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
              }" [disabled]="no_data == true || load_kh_code == false">
              Save
            </button>
            <button class="btn btn-round btn-min-width font-weight-bold mr-auto" (click)="cancleEx()" [ngClass]="{
                'bg-white pink border-pink text-pink ': no_data == false,
                'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
              }" [disabled]="no_data == true || load_kh_code == false">
              Cancel
            </button>
            <button (click)="OpenModal_Mail(templete_email)" class="btn btn-round btn-min-width font-weight-bold" [ngClass]="{
                'bg-white border-color-top tx-color-top': no_data == false,
                'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
              }" [disabled]="no_data == true || load_kh_code == false">
              Send E-mail
            </button>
            <button (click)="openModalx2Test(template2, dailyallowance_Dx)" class="btn btn-round btn-min-width font-weight-bold" [ngClass]="{
                'bg-top-blue text-white': no_data === false,
                'btn-secondary disabled cursor-not-allowed': no_data === true || load_kh_code === false
              }" [disabled]="no_data === true || load_kh_code === false">
              Export
            </button>

            <!-- //!! version เก่า-->
            <div class="col-12 py-3 d-none" *ngIf="show_button == true">
              <!-- # //save -->
              <button class="btn btn-round btn-min-width mr-1 mb-1 font-weight-bold d-sm-none col-sm-12 float-left" (click)="savecheck()" [ngClass]="{
                  ' bg-top-pink text-white': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Save
              </button>
              <button class="
                  btn btn-round btn-min-width
                  mr-1
                  ml-1
                  mb-1
                  font-weight-bold
                  d-md-block d-lg-block d-none
                  float-left
                " (click)="savecheck()" [ngClass]="{
                  'bg-top-pink text-white': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Save
              </button>
              <!-- # //save -->

              <!-- # //cancle -->
              <button class="btn btn-round btn-min-width mr-1 mb-1 font-weight-bold d-sm-none col-sm-12 float-left" (click)="cancleEx()" [ngClass]="{
                  'bg-white pink border-pink text-pink ': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Cancel
              </button>

              <button class="btn btn-round btn-min-width mr-1 mb-1 font-weight-bold d-md-block d-lg-block d-none float-left" (click)="cancleEx()" [ngClass]="{
                  'bg-white pink border-pink text-pink ': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Cancel
              </button>
              <!-- # //cancle -->

              <!-- ##//     Send E-mail -->
              <button (click)="OpenModal_Mail(templete_email)" class="btn btn-round btn-min-width mr-1 mb-1 float-right font-weight-bold d-sm-none col-sm-12" [ngClass]="{
                  'bg-white border-color-top tx-color-top': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Send E-mail
              </button>

              <button (click)="OpenModal_Mail(templete_email)" class="btn btn-round btn-min-width mr-1 mb-1 float-right font-weight-bold d-md-block d-lg-block d-none" [ngClass]="{
                  'bg-white border-color-top tx-color-top': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Send E-mail
              </button>
              <!-- ##//     Send E-mail -->

              <!--** // Export -->
              <button (click)="openModalx2Test(template2, dailyallowance_Dx)" class="btn btn-round btn-min-width mr-1 mb-1 float-right font-weight-bold d-sm-none col-sm-12" [ngClass]="{
                  'bg-top-blue text-white': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Export
              </button>

              <button (click)="openModalx2Test(template2, dailyallowance_Dx)" class="btn btn-round btn-min-width mr-1 mb-1 float-right font-weight-bold d-md-block d-lg-block d-none" [ngClass]="{
                  'bg-top-blue text-white': no_data == false,
                  'btn-secondary disabled cursor-not-allowed': no_data == true || load_kh_code == false
                }" [disabled]="no_data == true || load_kh_code == false">
                Export
              </button>
              <!--** // Export -->
            </div>
            <!-- //!! version เก่า-->
          </div>

          <button class="btn btn-round btn-top d-none" (click)="exportX('download')">Download File Excel</button>
          <button class="btn btn-round bg-success d-none" (click)="report()">Reoprt</button>
          <button class="btn btn-round btn-top d-none" (click)="openModalx2Test(template2, dailyallowance_Dx)">
            <i aria-hidden="true" class="fa fa fa-download px-2"></i>Export
          </button>
          <button class="d-none" #closeModel (click)="modalRef.hide()"></button>

          <ng-template #template>
            <div class="modal-body">
              <div class="row">
                <div class="col-12">
                  <button type="button" class="close pb-2" style="color: red" data-dismiss="modal" aria-label="Close" (click)="modalRef.hide()">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="col-12">
                  <label for="sendxx" class="font-weight-bold tx-gray-700">Send to :</label>

                  <input type="text" placeholder="" class="form-control" [(ngModel)]="mail_curent" [matAutocomplete]="mail_curent_val" (click)="set_modal()" (ngModelChange)="modelChanged($event)" />
                  <mat-autocomplete #mail_curent_val="matAutocomplete">
                    <mat-option *ngFor="let option of email_send" [value]="option.mail_to" [hidden]="option.mail_to == null || option.mail_to == '' ? true : false">
                      {{ option.mail_to }}
                    </mat-option>
                  </mat-autocomplete>
                </div>
                <div class="col-12">
                  <button class="btn btn-round bg-top-blue text-bold-500 col-3 my-2" (click)="add_email2(mail_curent)" style="color: white">
                    Add
                  </button>
                </div>
                <div class="col-12">
                  <div class="form-group position-relative has-icon-right" *ngFor="let listx of Email_sendX; let ii = index">
                    <div *ngIf="listx.emp_id == emp_idS">
                      <input type="text" class="form-control mb-1" [value]="listx.mail_to" />
                      <div class="form-control-position">
                        <i class="fa fa-times danger cursor-pointer" (click)="deleteRow(ii)" aria-hidden="true"></i>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <button class="btn btn-round bg-top-blue text-bold-500 col-3 my-2" *ngIf="Email_sendX.length > 0" style="color: white" (click)="sendmail()">
                    Send
                  </button>
                </div>
              </div>
            </div>
          </ng-template>

          <ng-template #template2>
            <div class="modal-header">
              <div class="col-sm-12 px-0 mx-0">
                <span class="modal-title tx-20" id="my-modal-title">
                  <i class="material-icons tx-bold tx-20">content_copy</i>
                  Preview Excel
                </span>
                <button type="button" class="close pb-2" style="color: red" data-dismiss="modal" aria-label="Close" (click)="modalRef.hide()">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </div>
            <div class="modal-body pr-0">
              <div class="row col-12 pr-0 mr-0" *ngFor="let mt of data_excel_view">
                <div class="col-12">
                  <h3 class="text-center font-weight-bold" style="color: #aeaaaa">BUSINESS TRIP ALLOWANCE FORM</h3>
                </div>
                <div class="col-12">
                  <h5 class="float-left">DOC NO : {{ doc_id }}</h5>
                  <h5 class="float-right">{{ mt.last_update }}</h5>
                </div>
                <div class="col-12">
                  <div class="row">
                    <div class="col-2 font-weight-bold m-0">Title</div>
                    <div class="col-6 text-wrap border m-0">{{ mt.title }}</div>
                    <!-- //!!user ยกเลิก -->
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && false">
                      <div class="col-2 font-weight-bold text-center m-0">TOTAL</div>
                      <!-- mt.total -->
                      <div class="col-2 float-right border m-0">
                        <span class="float-right">{{ total_raw | number }} {{ mt.unit }}</span>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() != 'oversea' && false">
                      <div class="col-2 font-weight-bold text-center m-0">TOTAL</div>
                      <!-- mt.total_thb -->
                      <div class="col-2 float-right border m-0">
                        <span class="float-right">{{ total_raw | number }}&nbsp;THB</span>
                        <!-- {{ total_raw }} -->
                      </div>
                    </ng-container>
                    <!-- //!!user ยกเลิก -->
                  </div>
                </div>

                <div class="col-12">
                  <div class="row">
                    <div class="col-2 font-weight-bold m-0">Name</div>
                    <div class="col-3 border m-0">
                      {{ mt.employee_id }}
                    </div>
                    <div class="col-3 border m-0">
                      {{ mt.employee_name }}
                    </div>
                    <!-- //!!user ยกเลิก -->
                    <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && false">
                      <div class="col-2 font-weight-bold text-center m-0">TOTAL</div>
                      <!-- mt.total_thb -->
                      <div class="col-2 float-right border m-0">
                        <span class="float-right">{{ picRate(total_raw, mt.EX_rate) | number }} THB</span>
                      </div>
                    </ng-container>
                    <!-- //!!user ยกเลิก -->
                  </div>
                </div>
                <div class="col-12">
                  <div class="row">
                    <div class="col-2 font-weight-bold m-0">Country</div>
                    <div class="col-2 border m-0">
                      {{ mt.country }}
                    </div>
                    <div class="col-2 m-0">Sect./Dept.</div>
                    <div class="col-2 text-wrap border m-0">
                      {{ mt.functional }}
                      <!-- <span matTooltip={{mt.functional}}>{{(mt.functional.length>10)?(mt.functional | slice:0:10)+'..' : mt.functional}}</span> -->
                    </div>
                    <div class="col-2 font-weight-bold m-0"></div>
                    <div class="col-2 float-right m-0"></div>
                  </div>
                </div>
                <div class="col-12">
                  <div class="row">
                    <div class="col-2 font-weight-bold m-0">Business Date</div>
                    <div class="col-2 border m-0">
                      {{ mt.business_date }}
                    </div>
                    <div class="col-2 m-0">Departure Date</div>
                    <div class="col-2 border m-0">
                      {{ mt.departure_date }}
                    </div>
                    <div class="col-2 text-center m-0">Arrival Date</div>
                    <div class="col-2 float-right border m-0">{{ mt.arrival_date }}</div>
                  </div>
                </div>
                <div class="col-12 pb-2">
                  <div class="row">
                    <div class="col-2 font-weight-bold m-0">GL Account</div>
                    <div class="col-2 border m-0">{{ mt.gl_account }}</div>
                    <div class="col-2 m-0">Cost Center</div>
                    <div class="col-2 border m-0">
                      {{ mt.cost_center }}
                    </div>

                    <div class="col-2 text-center m-0">I/O Number</div>
                    <div class="col-2 float-right border m-0">
                      {{ mt.io_number }}
                    </div>
                  </div>
                </div>

                <div class="col-12 text-center" style="background-color: #2f75b5; color: #ffc000">
                  <h5>Daily allowance</h5>
                </div>

                <div class="col-12 px-0 mx-0">
                  <table class="table table-bordered">
                    <thead>
                      <tr class="text-center" style="background-color: #aeaaaa">
                        <th>Days</th>
                        <th>Date</th>
                        <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                          <th style="width: 13%">
                            < 6 hr</th>
                          <th style="width: 13%">6-12 hr</th>
                          <th style="width: 13%">> 12 hr</th>
                        </ng-container>
                        <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'">
                          <th style="width: 19%">ไม่ค้างคืน</th>
                          <th style="width: 19%">ค้างคืน</th>
                        </ng-container>
                        <!-- <th> &lt; 6 hr </th>
                                                <th> 6-12 hr </th>
                                                <th> &gt; 12 hr </th> -->
                        <th>TOTAL</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr class="text-center" *ngFor="let dt of data_ExcelA['dailyallowance']">
                        <td>{{ dt.allowance_days }}</td>
                        <td>{{ dt.allowance_date }}</td>
                        <td class="text-center">{{ dt.allowance_low | currency: ' ':'symbol' }}</td>
                        <td class="text-center" *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() != 'local'">
                          {{ dt.allowance_mid | currency: ' ':'symbol' }}
                        </td>
                        <td class="text-center">{{ dt.allowance_hight | currency: ' ':'symbol' }}</td>
                        <td>
                          {{ dt.allowance_total | currency: ' ':'symbol' }}
                          <span *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && dt.allowance_unit != ''">
                            {{ dt.allowance_unit }}
                          </span>
                          <span *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea' && dt.allowance_unit == ''">
                            USD
                          </span>
                          <span *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'"> THB </span>
                        </td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <!-- showfromid(allowance_main,emp_idS)  -->
                      <tr *ngFor="let dataa of allowance_main; let ii = index">
                        <td [attr.colspan]="TRAVEL_TYPE_OL.toLocaleLowerCase() === 'oversea' ? '5' : '4'" *ngIf="dataa.emp_id == emp_idS" class="text-right">
                          <span class="tx-14 font-weight-bold">TOTAL ALLOWANCE</span>&nbsp;&nbsp;
                        </td>
                        <td colspan="1" *ngIf="dataa.emp_id == emp_idS" class="text-center">
                          <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'oversea'">
                            <ng-container *ngFor="let mt of data_excel_view">
                              {{ total_raw || 0 | currency: '$':'symbol' }}
                            </ng-container>
                          </ng-container>
                          <ng-container *ngIf="TRAVEL_TYPE_OL.toLocaleLowerCase() == 'local'">
                            {{ total_raw || 0 | currency: '฿':'symbol' }}
                          </ng-container>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>

                <div class="col-12">
                  <div class="row">
                    <div class="col-12 px-0 mx-0 font-weight-bold" style="color: #aeaaaa">FLIGHT SCHEDULE</div>
                  </div>
                </div>

                <div class="col-12">
                  <div class="row">
                    <table class="table table-bordered">
                      <thead>
                        <tr class="text-center" style="background-color: #d0cece">
                          <th>Date</th>
                          <th>From</th>
                          <th>To</th>
                          <th>Flight</th>
                          <th>Depature Time</th>
                          <th>Arrival Time</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="text-center" *ngFor="let dtf of data_ExcelA['flightschedule']">
                          <td>{{ dtf.airticket_date }}</td>
                          <td>{{ filter_location(dtf.airticket_route_from) }}</td>
                          <td>{{ filter_location(dtf.airticket_route_to) }}</td>
                          <td>{{ dtf.airticket_flight }}</td>
                          <td>{{ dtf.airticket_departure_time }}</td>
                          <td>{{ dtf.airticket_arrival_time }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <!-- <div class="col-12 pt-2 text-center" style="background-color: #2f75b5; color: #ffc000">
                  <h5>Accommodation</h5>
                </div>
                <div class="col-12">
                  <div class="row">
                    <div class="col-6" style="background-color: #f2f2f2">Booking by Travel Agent</div>
                    <div class="col-6" style="background-color: #f2f2f2">
                      Booking by others and reclaim after travelling
                    </div>
                  </div>
                </div> -->
                <ng-container *ngIf="TRAVEL_TYPE_OL == 'oversea'">
                  <div class="col-12 pt-2">
                    <div class="row">
                      <div class="col-12 font-weight-bold px-0" style="color: #aeaaaa">RECORD OF OUTFIT ALLOWANCES</div>
                    </div>
                  </div>

                  <div class="col-12 pt-2" *ngIf="TRAVEL_TYPE_OL == 'oversea'">
                    <div class="row">
                      <div class="col-3 px-0" style="color: #aeaaaa">LUGGAGE & CLOTHING (THB)</div>
                      <div class="col-3 border px-0">{{ mt.luggage_clothing | number }}</div>
                      <div class="col-2" style="color: #aeaaaa">Valid Date</div>
                      <div class="col-4 border px-0">{{ mt.luggage_clothing_date }}</div>
                    </div>
                  </div>

                  <div class="col-12 pt-2">
                    <div class="row">
                      <div class="col-3 px-0" style="color: #aeaaaa">PASSPORT (THB)</div>
                      <div class="col-3 border px-0">{{ mt.passport | currency: ' ':'symbol' }}</div>
                      <div class="col-2" style="color: #aeaaaa">Valid Date</div>
                      <div class="col-4 border px-0">{{ mt.passport_date }}</div>
                    </div>
                  </div>
                </ng-container>
                <div class="col-12 pt-2 pb-2">
                  <div class="row">
                    <div class="col-12 font-weight-bold px-0" style="color: #aeaaaa">Remark</div>
                    <div class="col-12 px-0">
                      <ng-container *ngFor="let dataa of showfromid(allowance_main, emp_idS); let ii = index">
                        <ng-container *ngIf="dataa.emp_id == emp_idS && ii == 0">
                          <textarea [(ngModel)]="dataa.remark" class="form-control bg-white" rows="2" [disabled]="true"></textarea>
                        </ng-container>
                      </ng-container>
                    </div>
                  </div>
                </div>

                <!-- <div class="col-12 px-0 pt-2">
                  <button class="btn btn-round btn-top" (click)="exportX('download')">Download File Excel</button>
                </div> -->
              </div>
            </div>
            <div class="modal-footer">
              <div class="col-12 px-0">
                <button class="btn btn-round btn-top text-bold-500 btn-min-width" (click)="exportX('download')">
                  Download File Excel
                </button>
              </div>
            </div>
          </ng-template>

          <ng-template #templete_email>
            <div class="modal-header">
              <div class="col-sm-12 px-0 mx-0">
                <span class="modal-title tx-20" id="my-modal-title"><i class="fa fa fa-envelope px-1"></i> Send E-mail
                </span>
                <button type="button" class="close pb-2" style="color: red" data-dismiss="modal" aria-label="Close" (click)="modal_Ref_mail.hide()">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </div>
            <!-- for Search Emp -->
            <div class="modal-body">
              <div class="row">
                <div class="col-sm-12">
                  <!-- Mail TO -->
                  <div class="form-group">
                    <mat-form-field class="w-100">
                      <mat-label>TO</mat-label>

                      <mat-chip-list #chipList>
                        <mat-chip *ngFor="let EmpList of MailList; let indx = index" [selectable]="selectable" [removable]="removable" (removed)="remove(EmpList, indx, 'to')">
                          {{ EmpList.displayname }}
                          <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                        </mat-chip>
                        <input placeholder="username@thaioilgroup.com" matInput #fInput [formControl]="fCtrl" [matAutocomplete]="auto" (click)="set_modal()" [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur" (matChipInputTokenEnd)="add($event, 'to')" [(ngModel)]="inputText" (ngModelChange)="doFilter('inputText')" />
                      </mat-chip-list>
                      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="[selected($event, 'to'), (fInput.value = '')]">
                        <mat-option *ngFor="let EmpList of filteredEmp | async" [value]="EmpList" [hidden]="!CheckData(fInput.value)">
                          {{ displayName(EmpList) }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>
                  </div>
                  <!-- Mail TO -->
                  <!-- <pre>{{MailList|json}}</pre> -->
                  <!-- for Search Emp -->

                  <!-- MailCC -->
                  <div class="form-group">
                    <mat-form-field class="w-100">
                      <mat-label>CC</mat-label>

                      <mat-chip-list #chipListCC>
                        <mat-chip *ngFor="let EmpList of MailListCC; let indx = index" [selectable]="selectable" [removable]="removable" (removed)="remove(EmpList, indx, 'cc')">
                          {{ EmpList.displayname }}
                          <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                        </mat-chip>
                        <input placeholder="username@thaioilgroup.com" matInput #fInputcc [formControl]="fCtrlCC" (click)="set_modal()" [matAutocomplete]="autoCC" [matChipInputFor]="chipListCC" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur" (matChipInputTokenEnd)="add($event, 'cc')" [(ngModel)]="inputTextCC" (ngModelChange)="doFilter('inputTextCC')" />
                      </mat-chip-list>
                      <mat-autocomplete #autoCC="matAutocomplete" (optionSelected)="[selected($event, 'cc'), (fInputcc.value = '')]">
                        <mat-option *ngFor="let EmpList of filteredEmpCC | async" [value]="EmpList" [hidden]="!CheckData(fInputcc.value)">
                          {{ displayName(EmpList) }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <div class="col-12 px-0">
                <button class="btn btn-round btn-top text-bold-500 btn-min-width" (click)="Config_Email_Send(1, { fInput: fInput, fInputcc: fInputcc })" style="color: white">
                  Send
                </button>
              </div>
            </div>

            <!-- MailCC -->
          </ng-template>
        </div>
      </div>
    </div>
  </div>
</div>